use Mojolicious::Lite;
use TechStudy::Color;
use utf8;

get '/' => sub {
    my $self = shift;
    $self->render( 'index'  );
};

post '/show_color' => sub {
    my $self = shift;
    my $color = TechStudy::Color->new({
        R => $self->param('R'),
        G => $self->param('G'),
        B => $self->param('B')
    });

    # この値が画面の中央のBOXの背景色として表示されます.
    my $color_code = $color->get_color_code();

    $self->render(
        'show_color', 
        color_code => $color_code,
        R => $self->param('R'),
        G => $self->param('G'),
        B => $self->param('B'),
    );
};

post '/mix_color' => sub {

    my $self = shift;
    my $color_code_A = $self->param('color_code_A');
    my $color_code_B = $self->param('color_code_B');

    # $mixed_color_codeのカラーコードがResultsの色になります.
    #my $mixed_color_code = "dummy"; # 適当な値(修正してください)

    my $colorA = TechStudy::Color->new_from_code($color_code_A); 
    my $colorB = TechStudy::Color->new_from_code($color_code_B); 
    my $colorAB = $colorA->mix_color($colorB); 
    my $mixed_color_code = $colorAB->get_color_code(); 

    # 適当な値(修正してください)
    # 実装例 : この通りに作らなくても良いです.
    #  my colorA = $color_code_A->create_from_code(
    #    code => $color_code_A
    #  );
    #  my colorB  = $color_code_A->create_from_code(
    #    code => $color_code_A
    #  );
    #  $mixed_color = $colorA->mix( $colorB );
    #  $mixed_color_code = $mixed_color->get_color_code();

    $self->render( 'mix_color', 
        'color_code_A'     => $color_code_A,
        'color_code_B'     => $color_code_B,
        'mixed_color_code' => $mixed_color_code
    );

};

post '/show_weather' => sub {

    my $self = shift;
    my $city = $self->param('city');

    # http://www.google.com/ig/api?weather=xxx にアクセスして
    # 天気を処理するようなクラスをまずは作成しましょう.

    # 以下の部分を$heightestに作成したクラスから得た結果が
    # 入るように書き換えてみてください.
    my $heightest = { # この３行は削除してください. 
        day         => 'dummy',
        temperature => 'dummy'
    };

    $self->render( 'show_weather', 
        'city'        => $city,
        'day'         => $heightest->{day},
        'temperature' => $heightest->{temperature},
    );

};

app->start;
__DATA__

@@ index.html.ep
% layout 'root';
<div class="subject">
<h2>1.ShowColor</h2>
<p class="description"> R/G/Bの３つの値で指定した色がでるようにしてください.</p>
<form action="/show_color" method="POST">
<p>
R:<input name="R" class="tc" placeholder="255">
G:<input name="G" class="tc" placeholder="255">
B:<input name="B" class="tc" placeholder="255">
</p>
<p><input type="submit" value="ShowColor"></p>
</form>

<h2>2.MixColor</h2>
<p class="description"> 2色のカラーコードを入力すると, 2つの色が重なった色(加算)が表示されるようにしてください</p>
<form action="/mix_color" method="POST">
<p>ColorCodeA : <input name="color_code_A" placeholder="#FFDD00"></p>
<p>ColorCodeB : <input name="color_code_B" placeholder="#00DDBB"></p>
<p><input type="submit" value="MixColor"></p>
</form>

<h2>3.ShowWeather</h2>
<p class="description">http://www.google.com/ig/api?weather=xxx を用いて入力した地名の,今後数日の最高気温とその曜日が表示されるようにしてください.</p>
<p class="description">testは何週間後に実行しても通るようなつくりにしておきましょう</p>
<form action="/show_weather" method="POST">
<p>City: <input name="city" placeholder="Tokyo"></p>
<p><input type="submit" value="ShowWeather"></p>
</form>

<h2>発展課題(余力がある人向け)</h2>
<p class="description">色空間(RGBA,RGB,CMYK,CMY,HSV,HLS)の変換を行えるようなページを作ってみてください.( 例 : RGBAを入力すると背景が白の場合のRGBが出力等 )</p>

</div><!-- subject -->

@@ show_color.html.ep
% layout 'root';
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>
<p>
<span class="tc" style="color:red;"    >R: <%= $R %></span> /
<span class="tc" style="color:green;"  >G: <%= $G %></span> /
<span class="tc" style="color:blue;"   >B: <%= $B %></span> 
</p>
<div class="show_color" style="background:<%= $color_code %>">
<p>Code : <%= $color_code %>
</div>
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>

@@ mix_color.html.ep
% layout 'root';
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>
<h2>Sources</h2>
<div class="source">
<div class="colorA" style="background:<%= $color_code_A %>" ></div>
<div class="colorB" style="background:<%= $color_code_B %>" ></div>
</div><!--/source-->
<h2>Results</h2>
<div class="mixedColor" style="background:<%= $mixed_color_code%>" ></div>
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>

@@ show_weather.html.ep
% layout 'root';
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>
<h2>heightest day : <%= $city %></h2>
<p>day : <%= $day %></p>
<p>temperature : <%= $temperature %></p>
<p class="back"><a href="/">&lt;&lt;&nbsp;Back</a></p>

@@ layouts/root.html.ep
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf8"  />
<style>
body {
    background : #000;
}
.content {
    background : #FFF;
    padding    : 1em;
    width      : 500px;
    margin     : 0px auto
}


.subject h2 {
    border-bottom :1px dashed #999;
}

.subject p.description {
    background-color : #DDD;
    font-size : 80%;
    padding : 3px;
}

.show_color {
    padding : 1em; 
    margin  : 0px auto
}

input.tc {
   width:3em;
}

span.tc {
   font-weight:bold;
}

.source {
    height : 80px;
    width  : 300px;
    margin-left : 2em;
}
.content {
    background : #FFF;
    padding    : 1em;
    width      : 500px;
    margin     : 0px auto
}
.colorA {
    width  : 100px;
    height : 50px;
    float  : left;
}
.colorB {
    width  : 100px;
    height : 50px;
    float  : left;
}
.mixedColor {
    height : 100px;
    width  : 200px;
    margin-left : 2em;
}
p.allow {
    text-align : center;
}
</style>
</head>
<body>
<div class="content">
<%= content %>
</div><!--/content-->
</body>
</html>



