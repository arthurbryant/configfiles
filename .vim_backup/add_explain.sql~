-- ユーザー
-- ユーザが着用中のミクコレを取得
        EXPLAIN SELECT skin_id
        FROM touchskin_member_skin_relation
        WHERE member_id = 10022634;
+----+-------------+--------------------------------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table                          | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+--------------------------------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | touchskin_member_skin_relation | const | PRIMARY       | PRIMARY | 4       | const |    1 |       |
+----+-------------+--------------------------------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)

-- ストアでの公開中ミクコレ一覧
        EXPLAIN SELECT SQL_CALC_FOUND_ROWS id, skin_type, name, skin_version, contents_id
        FROM touchskin_skin_data
        WHERE status IN (1, 2)
        AND open_datetime <= NOW()
        AND close_datetime >= NOW()
        ORDER BY open_datetime DESC
        LIMIT 0, 10;
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
| id | select_type | table               | type | possible_keys | key  | key_len | ref  | rows | Extra                       |
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
|  1 | SIMPLE      | touchskin_skin_data | ALL  | key_2         | NULL | NULL    | NULL |    8 | Using where; Using filesort |
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
1 row in set (0.00 sec)

-- ストアでの「無料」「有料」「タイアップ」指定する公開中ミクコレ一覧
        EXPLAIN SELECT SQL_CALC_FOUND_ROWS id, skin_type, name, skin_version, contents_id
        FROM touchskin_skin_data
        WHERE skin_type = 0 AND status IN(1,2) AND open_datetime <= NOW() AND close_datetime >= NOW()
        ORDER BY open_datetime DESC
        LIMIT 0, 10;
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
| id | select_type | table               | type | possible_keys | key  | key_len | ref  | rows | Extra                       |
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
|  1 | SIMPLE      | touchskin_skin_data | ALL  | key_1,key_2   | NULL | NULL    | NULL |    8 | Using where; Using filesort |
+----+-------------+---------------------+------+---------------+------+---------+------+------+-----------------------------+
1 row in set (0.00 sec)

-- ミクコレストアで、特定ジャンルのミクコレ一覧を取得する
        EXPLAIN SELECT SQL_CALC_FOUND_ROWS skin.id, skin.skin_type, skin.name, skin.skin_version, skin.contents_id
        FROM touchskin_skin_data skin 
            JOIN touchskin_skin_genre_relation relation ON skin.id = relation.skin_id
            JOIN touchskin_genre_data genre ON relation.genre_id = genre.id
        WHERE genre.id = 1
            AND skin.status IN (1,2)
            AND skin.open_datetime <= NOW()
            AND skin.close_datetime >= NOW()
        ORDER BY skin.open_datetime DESC
        LIMIT 0, 10;
+----+-------------+----------+--------+---------------+---------+---------+----------------------------+------+----------------------------------------------+
| id | select_type | table    | type   | possible_keys | key     | key_len | ref                        | rows | Extra                                        |
+----+-------------+----------+--------+---------------+---------+---------+----------------------------+------+----------------------------------------------+
|  1 | SIMPLE      | genre    | const  | PRIMARY       | PRIMARY | 4       | const                      |    1 | Using index; Using temporary; Using filesort |
|  1 | SIMPLE      | relation | ref    | PRIMARY,key_1 | PRIMARY | 4       | const                      |    5 | Using index                                  |
|  1 | SIMPLE      | skin     | eq_ref | PRIMARY,key_2 | PRIMARY | 4       | touchskin.relation.skin_id |    1 | Using where                                  |
+----+-------------+----------+--------+---------------+---------+---------+----------------------------+------+----------------------------------------------+
3 rows in set (0.00 sec)

-- ミクコレストアで、ジャンルと「無料」「有料」「タイアップ」を指定してミクコレ一覧を取得する
        EXPLAIN SELECT SQL_CALC_FOUND_ROWS skin.id, skin.skin_type, skin.name, skin.skin_version, skin.contents_id
        FROM touchskin_skin_data skin
        JOIN touchskin_skin_genre_relation relation ON skin.id = relation.skin_id
        JOIN touchskin_genre_data genre ON relation.genre_id = genre.id
        WHERE genre.id = 1 AND skin.skin_type = 0 AND skin.status IN (1,2) AND skin.open_datetime <= NOW() AND skin.close_datetime >= NOW()
        ORDER BY skin.open_datetime DESC
        LIMIT 0,10;
+----+-------------+----------+--------+---------------------+---------+---------+-------------------------+------+-----------------------------+
| id | select_type | table    | type   | possible_keys       | key     | key_len | ref                     | rows | Extra                       |
+----+-------------+----------+--------+---------------------+---------+---------+-------------------------+------+-----------------------------+
|  1 | SIMPLE      | genre    | const  | PRIMARY             | PRIMARY | 4       | const                   |    1 | Using index; Using filesort |
|  1 | SIMPLE      | skin     | ALL    | PRIMARY,key_1,key_2 | NULL    | NULL    | NULL                    |    8 | Using where                 |
|  1 | SIMPLE      | relation | eq_ref | PRIMARY,key_1       | PRIMARY | 8       | const,touchskin.skin.id |    1 | Using index                 |
+----+-------------+----------+--------+---------------------+---------+---------+-------------------------+------+-----------------------------+
3 rows in set (0.00 sec)

-- 指定したミクコレを取得する
        EXPLAIN SELECT *
        FROM touchskin_skin_data
        WHERE id = 1;
+----+-------------+---------------------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table               | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+---------------------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | touchskin_skin_data | const | PRIMARY       | PRIMARY | 4       | const |    1 |       |
+----+-------------+---------------------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)

-- 公開中のジャンル一覧を取得する
        EXPLAIN SELECT id,genre_name
        FROM touchskin_genre_data
        WHERE display = 'y'
        ORDER BY priority DESC;
+----+-------------+----------------------+------+---------------+------+---------+------+------+-----------------------------+
| id | select_type | table                | type | possible_keys | key  | key_len | ref  | rows | Extra                       |
+----+-------------+----------------------+------+---------------+------+---------+------+------+-----------------------------+
|  1 | SIMPLE      | touchskin_genre_data | ALL  | display       | NULL | NULL    | NULL |    4 | Using where; Using filesort |
+----+-------------+----------------------+------+---------------+------+---------+------+------+-----------------------------+
1 row in set (0.00 sec)

-- ジャンル情報を1件取得する
        EXPLAIN SELECT *
        FROM touchskin_genre_data
        WHERE id = 1;
+----+-------------+----------------------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table                | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+----------------------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | touchskin_genre_data | const | PRIMARY       | PRIMARY | 4       | const |    1 |       |
+----+-------------+----------------------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)
