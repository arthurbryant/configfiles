
/*
 * GET home page.
 */

exports.report= function(req, res){
        var mysql = require('mysql');
        var connection = mysql.createConnection({
            host        : 'dev.mysql.lo.mixi.jp',
            user        : 'root',
            password    : '',
            database    : 'akio_watanabe',
        }); 
        
        connection.connect();
        var fetch_query = "select avg(decided_order) as avg_order , date(created_at) as date from decided_order group by date(created_at);"
        var query = connection.query(fetch_query, function(err, rows, field){
            if(err) throw err;

            var json = JSON.stringify(rows);
            res.contentType('application/json');
            res.send(json);
            console.dir(json);
        });
};

exports.main=function(req, res) {
    res.render("report",{});
};
exports.test=function(req, res) {
    res.render("distance_compute",{});
};
exports.distance = function(req, res) {
            var request = $.ajax({
                 url: "http://maps.googleapis.com/maps/api/directions/",
                  type: "POST",
                  data: {
                        origin : "東京都渋谷区東１丁目２−２０",
                        destination : "東京都渋谷区渋谷４−４−２５",
                        sensor : false,
                        mode : "walking"
                  },
                    dataType: "json"
                });
                 
                request.done(function(msg) {
                      $("#log").html( msg );
                  });
                   
                  request.fail(function(jqXHR, textStatus) {
                        alert( "Request failed: " + textStatus );
                    });
    
                
};
