package Mixi::Template::Role::Admin;
use Mouse::Role;
use MouseX::AttributeHelpers;
use Mixi;
use Mixi::Config;

with q|Mixi::Template::Role::AbstractInterface|;

before _auto_assign_common_params => sub {
    my $self = shift;
    $self->param( is_admin => 1 );
};

sub admin_type {
    $ENV{SCRIPT_FILENAME} =~ m!gear/([_a-zA-Z0-9]+)/! if $ENV{SCRIPT_FILENAME};
    return $1;
}

around default_common_paths => sub {
    my ( $next, $self, @args ) = @_;

    # 管理ツールの場合に優先されるパス
    return (
        Mixi::Config::NEW_ADMIN_TMPL_PATH . '/common/', $self->$next(@args),
    );
};

around default_paths => sub {
    my ( $next, $self, @args ) = @_;
    my $admin_type = $self->admin_type;

    # 管理ツールの場合に優先されるパス
    return (
        ($admin_type)
        ? Mixi::Config::NEW_ADMIN_TMPL_PATH . '/' . $admin_type
        : (),
        Mixi::Config::NEW_ADMIN_TMPL_PATH,
        $self->$next(@args),
    );
};

1;
__END__

=encoding euc-jp

=head1 NAME

Mixi::Template::Role::Admin - 管理ツール用拡張

=head1 AUTHOR

大窪 聡 E<lt>ohkubo@mixi.co.jpE<gt>
広木　大地E<lt>daichi.hiroki@mixi.co.jpE<gt>

=cut
